---
title: "2019 Vietnam High School National Graduation Exam score analysis"
output: html_notebook
author:
  - name: Hoang Anh NGO
  - affiliation: Ecole Polytechnique, IP Paris
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 


```{r}
#import libraries
library(plyr)
library(tidyverse)
library(dplyr)
library(corrplot)
library(ggplot2)
library(ggcorrplot)
```


```{r}
#Import dataset diemthi2019.csv
diemthi2019 <- read.csv('~/Desktop/2019 vietnam national high school exam/diemthi2019.csv', row.names = NULL)

#Choose necessary columns and reorder them
head(diemthi2019)
str(diemthi2019)

#Import and modify dataset province_code.csv
province_code <- read.csv('~/Desktop/2019 vietnam national high school exam/province_code.csv', sep = ";", row.names = NULL)

#Change column type of province_code.csv
province_code$Province_code <- as.numeric(province_code$Province_code)
province_code$Province_name <- as.factor(province_code$Province_name)

head(province_code)
str(province_code)
```


```{r}
#Change column name for diemthi2019.csv
diemthi2019 <- plyr::rename(diemthi2019, c(
    'sbd' = 'Student_index',
    'Toan'= 'Maths',
    'Van' = 'Literature',
    'Ngoai_ngu' = 'Foreign_language',
    'Ma_mon_ngoai_ngu' = 'Foreign_language_code',
    'Li' = 'Physics',
    'Hoa' = 'Chemistry',
    'Sinh' = 'Biology',
    'Su' = 'History',
    'Dia' = 'Geography',
    'GDCD' = 'Citizenship_education'
    )
  )
head(diemthi2019)
```

```{r}
#Insert province_code for diemthi2019.csv
Province_code <- ifelse(diemthi2019$Student_index > 10000000,
            substr(as.character(diemthi2019$Student_index), start = 1, stop = 2),
            substr(as.character(diemthi2019$Student_index), start = 1, stop = 1)
)
diemthi2019$Province_code <- as.numeric(Province_code)

#insert foreign language names with respect to code
diemthi2019$Foreign_language_name <- diemthi2019$Foreign_language_code
diemthi2019$Foreign_language_name <- mapvalues(diemthi2019$Foreign_language_code, from=c("N1", "N2", "N3", "N4", "N5", "N6"), to=c("English", "Russian", "French", "Chinese", "German", "Japanese"))

head(diemthi2019)
```

```{r}
#Merge diemthi2019.csv and province_code.csv
diemthi2019 <- join(diemthi2019, province_code, by = "Province_code")
head(diemthi2019)
```


```{r}
#Calculate scores of combinations A00, A01, B00, C00, D00
diemthi2019$A00 <- diemthi2019$Maths + diemthi2019$Physics + diemthi2019$Chemistry
if(diemthi2019$Foreign_language_code == 'N1') {
  diemthi2019$A01 <- diemthi2019$Maths + diemthi2019$Physics + diemthi2019$Foreign_language
}
diemthi2019$B00 <- diemthi2019$Maths + diemthi2019$Chemistry + diemthi2019$Biology
diemthi2019$C00 <- diemthi2019$Literature + diemthi2019$History + diemthi2019$Geography
if(diemthi2019$Foreign_language_code == 'N1') {
  diemthi2019$D00 <- diemthi2019$Maths + diemthi2019$Literature + diemthi2019$Foreign_language
}
head(diemthi2019)

#Calculate average of natural science combination and social science combination
diemthi2019$Avg_natural_sciences <- (diemthi2019$Physics + diemthi2019$Chemistry + diemthi2019$Biology)/3
diemthi2019$Avg_social_sciences <- (diemthi2019$History + diemthi2019$Geography + diemthi2019$Citizenship_education)/3
```

```{r}
#Reorder and choose necessary columns
diemthi2019 <- diemthi2019[c('Student_index', 'Province_code', 'Province_name', 'Maths', 'Literature', 'Foreign_language' ,'Foreign_language_code', 'Foreign_language_name', 'Physics', 'Chemistry', 'Biology', 'Avg_natural_sciences', 'History', 'Geography', 'Citizenship_education', 'Avg_social_sciences', 'A00', 'A01', 'B00', 'C00', 'D00')]
head(diemthi2019)
```


```{r}
#numerical df for correlation matrix
diemthi2019_corr <- diemthi2019[c(4:6,9:21)]

#correlation matrix
diemthi2019_corr_matrix <- cor(diemthi2019_corr, use="pairwise.complete.obs")
View(diemthi2019_corr_matrix)

#correlation heatmap
ggcorrplot(diemthi2019_corr_matrix, hc.order = TRUE,
   lab = TRUE)
```

```{r}
#Number of students who takes each foreign language test
table(diemthi2019$Foreign_language_name)
```

```{r}
#Number of students who are eligible to be considered for admission with each combination A00, A01, B00, C00, D00
combination_eligible <- list()
for(i in c(17:21)) {
  print(paste('The number of students who are eligible to be considered for combination', colnames(diemthi2019[i]), 'is', sum(!is.na(diemthi2019[,i]) == TRUE))) 
  combination_eligible[[i-16]] = table(!is.na(diemthi2019[,i]), dnn = paste(colnames(diemthi2019)[i]))
}
combination_eligible
```

```{r}
#Number of students who took all natural science subjects, all social science subjects, or all of both
print(paste('The number of students who took all natural science subjects is', sum(!is.na(diemthi2019[,13]) == TRUE)))
print(paste('The number of students who took all social science subjects is', sum(!is.na(diemthi2019[,17]) == TRUE)))
print(paste('The number of students who took all natural and social science subjects is', sum(!is.na(diemthi2019[,13]) == TRUE & !is.na(diemthi2019[,17]) == TRUE)))
```


```{r}
#Find the maximum score for each column
for(i in c(4:6,9:21)) {
  print(paste('The maximum score of',colnames(diemthi2019)[i],'is', max(diemthi2019[,i], na.rm = TRUE)))
}
```

```{r}
histogram_out <- list()
for(i in c(4:6,9:21)) {
  x = diemthi2019[,i]
  histogram_out[[i]] <- ggplot(data.frame(x), aes(x)) + 
    geom_histogram(binwidth = 0.1, color="black", fill="blue") +
    labs(title=paste("Score histogram for",colnames(diemthi2019)[i]), x=colnames(diemthi2019)[i], y="Count") + 
    geom_vline(data = diemthi2019, xintercept = mean(diemthi2019[,i], na.rm = TRUE), color = "red", linetype = "dashed", size = 1)
}
histogram_out
```

```{r}
table_score <- list()
for(i in c(4:6,9:21)) {
  table_score[[i]] = table(diemthi2019[,i], dnn = paste(colnames(diemthi2019)[i],'_scores'))
}

for(i in c(4:6,9:21)) {
  View(table_score[[i]])
}
#table_score
```

```{r}
summary(diemthi2019[,3])
```

```{r}
province_frequency <- table(diemthi2019[,3])
province_frequency <- sort(province_frequency, decreasing = FALSE)
View(province_frequency)
par(las=2)
barplot(province_frequency, main="Province Distribution", horiz=TRUE)
```


